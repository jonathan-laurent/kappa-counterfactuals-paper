% -*- TeX-master: "ijcai18.tex" -*-

\section{Counterfactuals and inhibition}\label{sec:inhibition}

\subsection{Using counterfactual resimulation in practice}
\label{sec:practice}

Returning to our example, let's see how we can use counterfactual
resimulation to improve our understanding of the typical causal
narrative leading to the phosphorylation of a substrate. First, how
may one come to suspect that the narrative that is shown
Figure~\ref{fig:dumb-story} is incomplete \textit{a priori} ? And
then, how should one know what interventions might be worth trying in
order to discover some additional causal structure through
counterfactual resimulation?

There is no perfect answer here but there are heuristics we can
use. In our example, one may notice by running repeated simulations
that when rule $p$ triggers, the kinase involved is very likely to be
phosphorylated. The fact that the causal narrative
Figure~\ref{fig:dumb-story} does not provide any insight into this
phenomenon is a sign that we should investigate whether it is
an accidental correlation or revealing of an unknown causal effect. In
order to do so, it is natural to intervene by blocking the last event
phosphorylating the kinase involved in $p$ in sampled traces. More
generally, when
\begin{inparaenum}[(i)]
\item an event $e$ in a candidate causal narrative is executed
  unusually often in a context which is more specific than what is
  required by the left-hand side of the associated rule and
\item this effect cannot be explained by the action of other events in
  the same causal narrative,
\end{inparaenum}
\textit{then} exploring counterfactual traces in which we block the last event
responsible for at least a part of the unexplained context in the
triggering a $e$ is likely to be worthwhile.

In our example, this heuristic suggests that we should
block the last event responsible for the phosphorylation of the kinase
before the substrate gets phosphorylated itself in sampled traces. For
the particular case of trace~(\ref{example-trace}) of
section~\ref{sec:example}, we ask: how likely is it that ``$p$ would
have happened had $pk$ not happened'' ?  This can be translated
literaly in the question of evaluating
$\mathbf{P}(\tau \!\models\! [\iota] \, \psi)$ where
\begin{inparaenum}[(i)]
  % \item $\tau$ is trace~(\ref{example-trace})
\item $\BLOCKED{\iota}{e'} = (e = pk)$ and
\item $\psi[\tau'] = (p \in \tau')$.\footnote{Here, by $p$ and $pk$,
    we refer to very specific events that appear at a particular time
    in $\tau$.}
\end{inparaenum}
This choice of $\iota$ and $\psi$ is reasonable most of the
time but some variations may be prefered occasionally. For example, if
the rule $pk$ for phosphorylating is very fast, blocking only a single
instance of the potential event associated with $pk$ may not have a
very large effect as a new instance would trigger almost immediately
after in most counterfactual traces, cancelling the effect of the
intervention.  In this case, it is useful to make $\iota$ block every
instance of the potential event associated with $pk$ in a defined
timeframe.

Sampling counterfactual traces repeatedly for
trace~(\ref{example-trace}) would reveal that ``event $p$ would not
have happened had $pk$ not happened'' with very high probability.
However, we can go further by using counterfactual traces to
\textit{explain} this influence using both activation and inhibition
arrows (Figure~\ref{fig:cex}).


\subsection{Counterfactual experiments}

A \textit{counterfactual experiment} is any triple
$(\tau, \iota, \tau')$ for which there exists a schedule $\sigma$ such
that $\tau = T(\sigma)$ and $\tau' = \ATRAJ{}(\sigma)$. Such triples
are produced by counterfactual resimulation.

\subsection{Activation and inhibition}


Before we start formalizing activation and inhibition, it is useful to
define some vocabulary about what it means for an event to \emph{test}
or \emph{modify} a site. Without loss of generality, we shall assume
that sites on an agent can either be binding sites or tagged sites
(sites carrying an internal state) but cannot have both functions. The
\textit{value} of a tagged site in a mixture is defined as its current
tag and the value of a binding site is either $\textsc{free}$ or
$\textsc{bound-to}(s)$, where $s$ identifies another site in the
mixture.  An event is said to \emph{modify} a site if it changes its
value when executed. It is said to \emph{test} a site $s$ to value $v$
if the left-hand side of the associated rule requires $s$ to have
value $v$ for it to be executable. For example, event $p$ in
trace~(\ref{example-trace}) tests three sites and modifies one.

\input{figures/cex}


%Looking closely at the counterfactual traces,
%one may 

%In this section, we show
