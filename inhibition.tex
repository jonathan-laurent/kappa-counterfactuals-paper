% -*- TeX-master: "ijcai18.tex" -*-

\section{Counterfactuals and inhibition}\label{sec:inhibition}

\paragraph{Remark on notation} Whereas we used the letter $e$ to
denote potential events in the previous sections, we use it to denote
\emph{events} from now on. Besides, we write $\TIME{e}$ the time of
occurence of event $e$. Finally, an event $e$ occuring at time $t$ is
said to be executable in trace $\tau$ if the associated potential
event is executable in mixture $\TSTATE{t}{\tau}$.


\subsection{Counterfactual experiments}

A \textit{counterfactual experiment} is any triple
$(\tau, \iota, \tau')$ for which there exists a schedule $\sigma$ such
that $\tau = T(\sigma)$ and $\tau' = \ATRAJ{}(\sigma)$. Such triples
are produced by counterfactual resimulation.

\begin{proposition}%[Characterization of counterfactual experiments]
  \label{prop:valid-cex}
  A triple $(\tau, \iota, \tau')$ is a (valid) counterfactual experiment if
  and only if all of the following hold:
  \begin{inparaenum}[(1)]
  \item \label{valid-cex:valid-traces} both $\tau$ and $\tau'$ are
    valid traces ;
  \item \label{valid-cex:no-blocking} no event of $\tau'$ is blocked
    by $\iota$ ;
  \item \label{valid-cex:co-occur} for every event $e \in \tau$
    such that $e \notin \tau'$, then either $e$ is not
    executable in $\tau'$ or $e$ is blocked by
    $\iota$ ;
  \item \label{valid-cex:co-occur2} for every event $e' \in \tau'$
    such that $e' \notin \tau$, then $e'$ is not triggerable in
    $\tau$.
  \end{inparaenum}
\end{proposition}

\subsection{Inhibition}


Before we start formalizing activation and inhibition, it is useful to
define some vocabulary about what it means for an event to \emph{test}
or \emph{modify} a site. Without loss of generality, we shall assume
that sites on an agent can either be binding sites or tagged sites
(sites carrying an internal state) but cannot have both functions. The
\textit{value} of a tagged site in a mixture is defined as its current
tag and the value of a binding site is either $\textsc{free}$ or
$\textsc{bound-to}(s)$, where $s$ identifies another site in the
mixture.  An event is said to \emph{modify} a site if it changes its
value when executed. It is said to \emph{test} a site $s$ to value $v$
if the left-hand side of the associated rule requires $s$ to have
value $v$ for it to be executable. For example, event $p$ in
trace~(\ref{example-trace}) tests three sites and modifies one.

\input{figures/cex}

\begin{definition}
  Let $(\tau, \iota, \tau')$ a counterfactual experiment. An
  event $e$ that occurs at time $t$ in $\tau$ is said to inhibit an
  event $e'$ that occurs at time $t'$ in $\tau'$ if all of the
  following hold:
  \begin{inparaenum}[(1)]
  \item \label{inhibition:time} $t < t'$ ;
  \item \label{inhibition:breaks} there exists a site $s$ such that
    $e$ is the last event in $\tau$ before $t'$ that modifies the
    value of $s$ away from what $e'$ tests it for ;
  \item \label{inhibition:nointf} there are no events in $\tau'$ that
    modify $s$ during the time interval $(t, t')$.
  \end{inparaenum}
  The same definiton holds switching $\tau$ and $\tau'$.
\end{definition}


The example illustrates the influence of $pk$ on $p$ mediated by the
counterfactual event $u$. Such mediating events always exist, as
stated by the following theorem.  In general, we can always %exhibit
a sequence of intermediate events connected by activation and
inhibition arrows to relate an event that is proper to the factual
trace to another one that is blocked by the intervention $\iota$.

\begin{theorem}\label{thm:completeness} 
  Let $(\tau, \iota, \tau')$ be a counterfactual experiment and $e$ an
  event that belongs only to $\tau$. Then there exists an event
  $\hat e \in \tau$ that is blocked by $\iota$ and there is a directed
  path from $\hat e$ to $e$ with an even number of inhibition arrows.
\end{theorem}
