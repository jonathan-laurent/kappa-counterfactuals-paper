\begin{algorithm}
\caption{Counterfactual resimulation}\label{alg:cosimulation}
\begin{spacing}{1.3}
\algsetup{indent=1.5em}
\begin{algorithmic}[1]
\vspace{0.2cm}
\STATE $t \gets 0$
\STATE $m \gets\ $ initial mixture
\WHILE{ $t < t_\text{\,end}$ }
  \STATE $m_0 \gets \TSTATE{t}{\tau}$
  \STATE $(e_{\text{f}}, t_{\text{f}}) \gets $ first event of $\tau$ in time interval $(t, \infty)$
  \vspace{0.1cm}
  \STATE $\alpha' \gets \sum_r {\lambda_r |\DEMBS{r}{m, m_0}|}$
  \vspace{0.1cm}
  \STATE draw $\delta \sim \textsc{Exp}(\alpha') $
  \STATE $t_{\text{c}} \gets t + \delta$
  % \STATE
  \IF { $t_{\text{c}} < t_{\text{f}}$ }
      \STATE draw a rule $r$ with prob.
      $\propto \, \lambda_r |\DEMBS{r}{m, m_0}|$
      \STATE  draw a divergent embedding $\xi \in \DEMBS{r}{m, m_0}$
      \STATE {$e \gets (r, \xi)$}
      \IF {$ \neg \, \BLOCKED{\iota}{e, t_{\text{c}}} $ }
          \STATE $t \gets t_{\text{c}}$
          \STATE $m \gets \UPDATE{m}{e}$
          \STATE log event $(e, t)$
      \ENDIF
  \ELSE
      \STATE $t \gets t_{\text{f}}$
      \IF {$ \neg \, \BLOCKED{\iota}{e, t} $ \AND $ \TRIGGERABLE{m}{e} $ }
          \STATE $m \gets \UPDATE{m}{e}$
          \STATE log event $(e, t)$
      
      \ENDIF 
  \ENDIF
\ENDWHILE
\vspace{0.1cm}
\end{algorithmic}
\end{spacing}
\end{algorithm}